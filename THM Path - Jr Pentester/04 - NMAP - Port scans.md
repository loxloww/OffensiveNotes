## Basic

3 techniques :
- TCP connect port scan
- TCP SYN port scan
- UDP port scan

nmap port states :
1. **Open**: indicates that a service is listening on the specified port.
2. **Closed**: indicates that no service is listening on the specified port, although the port is accessible. By accessible, we mean that it is reachable and is not blocked by a firewall or other security appliances/programs.
3. **Filtered**: means that Nmap cannot determine if the port is open or closed because the port is not accessible. This state is usually due to a firewall preventing Nmap from reaching that port. Nmap’s packets may be blocked from reaching the port; alternatively, the responses are blocked from reaching Nmap’s host.
4. **Unfiltered**: means that Nmap cannot determine if the port is open or closed, although the port is accessible. This state is encountered when using an ACK scan `-sA`.
5. **Open|Filtered**: This means that Nmap cannot determine whether the port is open or filtered.
6. **Closed|Filtered**: This means that Nmap cannot decide whether a port is closed or filtered.

###### TCP connect scan

work with the complet 3 way handshake
forced option : -sT
if no root user = only option for TCP port scan

```bash
nmap -sT IP
```

###### TCP SYN port scan

default method as privileged user

To not complet all 3 way handshake and established connection at all
need root user
structure :
- SYN
- SYN/ACK
- RST

option : -sS
```bash
nmap -sS IP
```

###### UDP port scan

## Advanced

###### TCP Null scan, FIN scan, and Xmas scan

NULL SCAN

send a TCP packet with all flag set to 0
behaviour expected : 
- RST response = port closed
- no repsonse = port open / filtered - firewall
```bash
nmap -sN IP
```

FIN SCAN

send TCP FIN packet
 - response : RST/ACK = closed
 - no response : open / or filtered - firewall
```bash
nmap -sF IP
```

Xmas SCAN

send packet with FIN, PSH, URG flag
- no response : open/filtered
- response RST, ACK : closed

```bash
nmap -sX IP
```
###### TCP Maimon scan

Old technic, work on few BSD derived systems -> drop packet if open
option : -sM

send a TCP packet with FIN and ACK flag set

###### TCP ACK, Window, and custom scan

TCP ACK
classic scenario :
- open or closed : response is RST

useful to detect firewall rule sets/conf
in context of firewall, we can see wich port scan ACK were not blocked

```bash
nmap -sA IP
```

TCP Window

almost the same as ACK, but inspect windows field of RST packet response:
- sometime contains info if port open
```bash
nmap -sW IP
```

CUSTOM SCAN

to send TCP packet with custom flag combination :
```bash
nmap -scanflags RSTSYNFIN IP
```
###### Spoofing / decoy

scan target using spoofed IP or MAC address
```bash
nmap -S SPOOFED_IP TARGET_IP
```
scenario :
1. Attacker sends a packet with a spoofed source IP address to the target machine.
2. Target machine replies to the spoofed IP address as the destination.
3. Attacker captures the replies to figure out open ports.

expected to use -Pn for no scan and specify interface -e
```bash
nmap -e NET_INTERFACE -Pn -S SPOOFED_IP MACHINE_IP
#RND for random at each request 
nmap -D 10.10.0.1,10.10.0.2,RND,RND,ME MACHINE_IP
```

Decoy

-> drawn ip attacker in several decoy
```bash
nmap -D 10.10.0.1,10.10.0.2,ME MACHINE_IP
```
###### Fragmented packets

can be useful to evade firewall/IDS if they inspect packet data
options : -f / --mtu
default size is 8 bytes

```bash
nmap -sS -f IP
```

###### Idle/Zombie scan

drawback of scan with spoofed ip is it only work in specific conditions where we can monitor network traffic
instead we can pass through another intermediate machine (zombie)

```bash
nmap -sI ZOMBIE_IP MACHINE_IP
```

open port work with deduction of the IP ID of idle/zombie machine
(incremented if target respond to him with a SYN/ACK packet for exemple)
###### Affine / more details

get more detail with option : --reason or -vv
```bash
nmap -sS --reason IP
```
